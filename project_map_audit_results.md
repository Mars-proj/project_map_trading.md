# Project Map: Audit Results

This file contains the results of the audit of the trading bot system's modules, including Core Trading Logic, Supporting Modules, and Additional Modules. Each entry includes the module name, its usage status, recommendations, useful settings (if any), and remarks.

## Audit Results
- **2025-03-28**: Модуль `json_handler.py` используется в системе (зависимость от `trade_executor_core.py`). Рекомендуется сохранить. Полезных настроек нет, но функции `dumps` и `loads` важны для сериализации данных. Замечание: В графе зависимостей указана связь `json_handler -> logging_setup`, но в коде этой зависимости нет. Удалена связь 2025-03-28.
- **2025-03-28**: Модуль `config_keys.py` используется в системе (зависимости от `start_trading_all.py`, `bot_user_data.py`). Рекомендуется сохранить. Полезные настройки: `API_KEYS` (хранит API-ключи для пользователей), `PREFERRED_EXCHANGES` (предпочтительные биржи для пользователей), `SUPPORTED_EXCHANGES` (список поддерживаемых бирж: `['mexc', 'binance', 'bybit', 'kucoin', 'okx']`).
- **2025-03-28**: Замечание: В графе зависимостей (`trading_bot_graph.dot`) отсутствует связь `config_keys.py` -> `logging_setup.py`, хотя `validate_api_keys` использует `logger_main`. Добавлена зависимость в граф 2025-03-28.
- **2025-03-28**: Модуль `backtest_cycle.py` потенциально используется в системе (зависимость от `bot_trading.py`). Рекомендуется сохранить, но подтвердить использование бэктестинга в `bot_trading.py`. Если бэктестинг не используется, модуль можно временно исключить из активного цикла. Полезные настройки: `initial_balance = 1000.0` (начальный баланс для бэктестинга), `trade_amount_percentage = 0.1` (процент от баланса для сделки), логика стратегий (`MovingAverageStrategy`, `RSIDivergenceStrategy`, `BollingerBandsBreakoutStrategy`, `MACDTrendFollowingStrategy`).
- **2025-03-28**: Модуль `signal_blacklist.py` используется в системе (зависимость от `trade_executor_core.py`). Рекомендуется сохранить. Полезных настроек нет. Замечания: 1) Импорт `logger_main` не используется, рекомендуется удалить. 2) В графе зависимостей указана связь `signal_blacklist -> redis_client`, но в коде этой зависимости нет. Удалена связь 2025-03-28.
- **2025-03-28**: Модуль `manual_trade.py` не используется в текущей системе (нет входящих зависимостей в графе). Удалён из системы 2025-03-28. Полезные настройки сохранены: `exchange_id='mexc'`, `symbol='BROCK/USDT'`, `user_id='USER1'`, `amount=100` (тестовые параметры для сделок); `'enableRateLimit': True`, `'timeout': 60000` (настройки биржи); структура данных сделки (`symbol`, `side`, `amount`, `price`, `user_id`, `strategy_name`, `timestamp`, `source`, `signals`, `signal_metrics`, `market_conditions`).
- **2025-03-28**: Замечание: В `manual_trade.py` импорт `logger_main` из `utils.py` не соответствует зависимости в графе (`manual_trade -> logging_setup`). Это подтверждает проблему с импортом `logger_main`, выявленную в `trade_executor_core.py`.
- **2025-03-28**: Модуль `notification_manager.py` не существует в системе, хотя указан в `trading_bot_graph.dot`. Удалён из графа зависимостей 2025-03-28. Если функциональность уведомлений понадобится, модуль можно добавить заново.
- **2025-03-28**: Модуль `async_balance_fetcher.py` не используется в текущей системе (нет входящих зависимостей в графе). Удалён из системы 2025-03-28. Полезные настройки сохранены: `max_concurrent_requests = 10` (максимальное количество одновременных запросов), `min_concurrent_requests = 1` (минимальное количество одновременных запросов), `retries=5` (количество повторных попыток), `delay=10` (задержка между попытками), логика обработки ошибок (`RequestTimeout`, `RateLimitExceeded`).
- **2025-03-28**: Замечание: В `async_balance_fetcher.py` код ссылается на `exchange_manager`, который отсутствует в графе. Это может быть устаревшей зависимостью.
- **2025-03-28**: Модуль `websocket_manager.py` не используется в текущей системе (нет входящих зависимостей в графе, и WebSocket-соединение для MEXC не реализовано). Удалён из системы 2025-03-28. Полезные настройки сохранены: `cache_key = f"ticker:{self.exchange.id}:{symbol}"` (формат ключа для кэширования тикеров), `redis_client.setex(cache_key, 30, ...)` (кэширование на 30 секунд), структура данных тикера (`last`, `bid`, `ask`, `timestamp`).
- **2025-03-28**: Модуль `rate_limiter.py` не существует в системе, хотя указан в `trading_bot_graph.dot`. Удалён из графа зависимостей 2025-03-28.
- **2025-03-28**: Модуль `error_handler.py` не существует в системе, хотя указан в `trading_bot_graph.dot`. Удалён из графа зависимостей 2025-03-28.
- **2025-03-28**: Модуль `performance_metrics.py` не существует в системе, хотя указан в `trading_bot_graph.dot`. Удалён из графа зависимостей 2025-03-28. Если функциональность сбора метрик производительности понадобится, модуль можно добавить заново.
- **2025-03-28**: Модуль `user_manager.py` не существует в системе, хотя указан в `trading_bot_graph.dot`. Удалён из графа зависимостей 2025-03-28. Если функциональность управления пользователями понадобится, модуль можно добавить заново.
- **2025-03-28**: Модуль `trade_history.py` не существует в системе, хотя указан в `trading_bot_graph.dot`. Удалён из графа зависимостей 2025-03-28. Если функциональность хранения истории сделок понадобится, модуль можно добавить заново.
- **2025-03-28**: Модуль `market_data_fetcher.py` не используется в текущей системе (нет входящих зависимостей в графе). Удалён из системы 2025-03-28. Полезные настройки сохранены: `cache_timeout=300` (время жизни кэша в Redis), `cache_key = f"ticker:{symbol}"` (формат ключа для кэширования), логика кэширования рыночных данных.
- **2025-03-28**: Модуль `config_settings.py` используется в системе (зависимость от `trade_executor_signals.py`). Рекомендуется сохранить, но удалить дублирующиеся настройки логирования (`LOGGING_SETTINGS` и `validate_logging_settings`), так как они уже есть в `logging_setup.py`. Полезные настройки: `get_dynamic_symbol_criteria` (`min_volatility: 0.05`, `min_volume: 500`, `max_spread: 0.005`, с корректировкой на основе волатильности), `get_backtest_settings` (`max_symbols: 100`, `timeframe: '4h'`, `limit: 500`, с корректировкой на основе волатильности), `EXCHANGE_CONNECTION_SETTINGS` (`timeout: 60000`, `rateLimit: 500`, `recvWindow: 30000`), `EXCHANGE_MANAGER_CACHE_SETTINGS` (`max_size: 1000`, `ttl: 3600`).
- **2025-03-28**: Модуль `exchange_connection_settings.py` не существует в системе, хотя указан в `trading_bot_graph.dot`. Удалён из графа зависимостей 2025-03-28. Его функциональность перенесена в `config_settings.py` (`EXCHANGE_CONNECTION_SETTINGS`).
- **2025-03-28**: Модуль `redis_initializer.py` используется в системе (зависимости от `trade_executor_signals.py`, `deposit_calculator.py`, `start_trading_all.py`, `redis_client.py`). Рекомендуется сохранить. Рекомендуется добавить `__all__ = ['redis_client']` для ясности. Полезные настройки: параметры подключения к Redis (`host='localhost'`, `port=6379`, `decode_responses=True`).
- **2025-03-28**: Модуль `json_handler.py` (перепроверка) используется в системе (зависимость от `trade_executor_core.py`). Рекомендуется сохранить. Полезных настроек нет, но функции `dumps` и `loads` важны для сериализации данных. Замечание: В графе зависимостей указана связь `json_handler -> logging_setup`, но в коде этой зависимости нет. Удалена связь 2025-03-28.
- **2025-03-28**: Модуль `redis_client.py` используется в системе (зависимости от `trade_executor_signals.py`, `bot_trading.py`, `start_trading_all.py`, `deposit_calculator.py`, `symbol_filter.py`). Рекомендуется сохранить. Методы `get_trades_from_cache` и `add_trade_to_cache` могут быть неиспользуемыми в текущей версии системы, но их стоит сохранить для возможного использования в будущем. Полезные настройки: `trades_key = f"trades:{user_id}"` (формат ключа для кэширования сделок), ограничение длины списка сделок до 100, срок жизни ключа для сделок 7 дней, `problematic_key = f"problematic_symbols:{exchange_name}"` (формат ключа для проблемных символов), срок жизни ключа для проблемных символов 30 дней.
- **2025-03-28**: Модуль `exchange_connection.py` не существует в системе, хотя упоминался как зависимость `config_keys.py`. Удалён из списка зависимостей `config_keys.py` в аудите, так как это устаревшая информация.
- **2025-03-28**: Модуль `utils.py` частично используется в системе (функция `log_exception` используется в `trade_blacklist.py`). Рекомендуется сохранить. Функция `calculate_dynamic_rsi_thresholds_wrapper` может быть полезна для стратегий, но в текущей системе не используется. Полезные настройки: параметры для `calculate_dynamic_rsi_thresholds` (`lookback_period=720`, пороговые значения RSI по умолчанию: `rsi_buy=30.0`, `rsi_sell=70.0`, квантили: 40-й для покупки, 70-й для продажи, корректировка при высокой волатильности: `rsi_buy *= 0.9`, `rsi_sell *= 1.1`, при низкой волатильности: `rsi_buy *= 1.1`, `rsi_sell *= 0.9`, ограничения: `rsi_buy` от 15.0 до 45.0, `rsi_sell` от 55.0 до 85.0). Замечания: 1) Добавить в граф зависимостей: `trade_blacklist -> utils`, `utils -> logging_setup`. 2) Исправить импорт `logger_main` в `trade_executor_core.py` (заменить `from utils import logger_main` на `from logging_setup import logger_main`).
- **2025-03-28**: Модуль `trade_blacklist.py` не используется в текущей системе (нет входящих зависимостей в графе). Удалён из системы 2025-03-28. Его функциональность, скорее всего, заменена кэшированием проблемных символов в Redis. Полезные настройки сохранены: формат чёрного списка как множество (`global_trade_blacklist`).
